<app-layout [loading$]="loading$">
  <div class="header-flex" header>
    <button class="router-button" mat-icon-button (click)="onBack()">
      <mat-icon>close</mat-icon>
    </button>
    <h1>
      {{
        isEdit
          ? ("event.edit.title" | transloco)
          : ("event.new.title" | transloco)
      }}
    </h1>
    <span class="spacer"></span>
    <button
      mat-icon-button
      form="eventForm"
      *ngIf="!hasRePayedDebts"
      [disabled]="eventForm.invalid"
    >
      <mat-icon>check</mat-icon>
    </button>
  </div>

  <div body>
    <div
      *ngIf="isEdit && hasRePayedDebts"
      class="mat-form-field-invalid hasRePayedDebts"
    >
      {{ "event.form.afterStartRepayDebts" | transloco }}
    </div>

    <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" id="eventForm">
      <mat-form-field class="full-width">
        <mat-label>{{ "event.form.name" | transloco }}</mat-label>
        <input matInput formControlName="name" required />
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>{{ "event.form.date" | transloco }}</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="date"
          required="true"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <separator position="outer"></separator>
      <grey-title
        *transloco="let t"
        [text]="t('common.addMember')"
      ></grey-title>

      <mat-form-field class="full-width">
        <input
          matInput
          formControlName="organizer"
          required="true"
          *transloco="let t"
          [placeholder]="t('common.yourName')"
        />
      </mat-form-field>

      <div
        *ngIf="eventForm.errors?.hasMembersDuplicates"
        class="mat-form-field-invalid"
      >
        {{ "event.form.hasMembersDuplicates" | transloco }}
      </div>

      <div
        *ngIf="eventForm.errors?.organizerInMembers"
        class="mat-form-field-invalid"
      >
        {{ "event.form.organizerInMembers" | transloco }}
      </div>

      <div formArrayName="members">
        <mat-form-field
          class="full-width"
          *ngFor="let member of members.controls; let i = index"
          [formGroupName]="i"
        >
          <input
            matInput
            formControlName="name"
            *transloco="let t"
            [placeholder]="t('common.addMember')"
          />
        </mat-form-field>
      </div>
    </form>
  </div>
</app-layout>
